```{r echo=FALSE}
library(reticulate)
tmp_out <- include_supplement("venv_paths.csv")
tmp_out <- include_supplement("taiwan_dataset.csv", dir="../data")

venv_paths <- read.csv("venv_paths.csv")
id <- match(Sys.info()["nodename"], venv_paths$nodename)
use_virtualenv(venv_paths$path[id])
```

Question
========

Consider the broken line regression model that we fitted to the Taiwan real 
estate price data, with housing age as the explanatory variable. In the notes,
we used the value 25 years. In the following function we can input the age we 
wish to set the breakpoint at. The function returns the adjusted $R^2$ for the 
corresponding regression model.

```
def housing_break(age, data):
    tmp_data = data.copy()
    tmp_data['x3'] = [ (x - age) if x > age else 0 for x in data.house_age]
    lm_age_mrt_2 = ols('price ~ house_age + x3', data=tmp_data).fit()
    return lm_age_mrt_2.rsquared_adj
```

Use the function above to identify the "best" value of `age` to use in the
model. Name one downside of using this value.

Solution
========

```{python}
def housing_break(age, data): 
    tmp_data = data.copy() 
    tmp_data['x3'] = [ (x - age) if x > age else 0 for x in data.house_age] 
    lm_age_mrt_2 = ols('price ~ house_age + x3', data=tmp_data).fit() 
    return lm_age_mrt_2.rsquared_adj

age_grid = np.arange(0, 45, step = 0.1)
r2_vals = [housing_break(x, re2) for x in age_grid]

id = np.argmax(r2_vals)

print(f"The optimal house age is {age_grid[id]:.1f}")
```

One downside of using this value is that it could be overfitted to this
particular dataset.

Meta-information
================
exname: regression, inference, taiwan
extype: string
exstringtype: essay
exsolution: nil
