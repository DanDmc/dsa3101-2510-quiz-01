# Dockerfile_api

# === Base image ===
FROM python:3.11-slim

# === Environment Variables ===
ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1

# === Set working directory ===
WORKDIR /app

# === Install OS dependencies ===
# ðŸš¨ CONSOLIDATION FIX: Added curl, netcat-traditional, and libpoppler-cpp-dev
# These are required for healthchecks, system stability, and pdfplumber's image generation.
RUN apt-get update && apt-get install -y --no-install-recommends \ 
    default-libmysqlclient-dev build-essential pkg-config curl \ 
    build-essential \
    pkg-config \
    curl \
    netcat-traditional \
    libpoppler-cpp-dev \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# === Copy application files ===
# Assumes requirements.txt is at /app/requirements.txt after copying.
COPY backend_app/ ./

# === Install Python dependencies ===
RUN pip install --no-cache-dir -r requirements.txt

# === Expose application port ===
EXPOSE 5000

# === Start API using Gunicorn ===
# Retaining the long timeout (900s) to support the synchronous upload_file pipeline.
CMD ["gunicorn", "--bind", "0.0.0.0:5000", "--timeout", "900", "--workers", "3", "app:app"]